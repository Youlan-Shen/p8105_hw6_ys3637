---
title: "p8105_hw6_ys3637"
author: "Youlan Shen"
date: "2022-12-03"
output: github_document
---

## Set up

```{r}
# library all packages that we need at the beginning
library(tidyverse)

set.seed(1)

# default set up
theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 2

First loads, tidies, and clean the data.

Create a city_state variable, omit 4 cities, and limit race to White and Black

```{r}
# read in data from CSV file
homicide_data <- read_csv("Data/homicide-data.csv")
# show the first several lines of the original data
homicide_data
# Create a city_state variable, omit 4 cities, and limit race to White and Black
homicide_data <- homicide_data %>% 
  janitor::clean_names() %>% 
  mutate(city_state = str_c(city, ", ", state),
         victim_age = as.numeric(victim_age)) %>% 
  filter(!city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")) %>% 
  filter(victim_race %in% c("White","Black"))
# show the first several lines of the cleaned data
homicide_data
```

For the city of Baltimore, MD, to fit a logistic regression on resolved and unresolved as the outcome, and victim age, sex and race as predictors.

First we mutate the disposition to a binary outcome and select predictors.

```{r}
# first mutate the disposition column and save the dataframe
baltimore_data <- 
  homicide_data %>% 
  filter(city_state == "Baltimore, MD") %>% 
  mutate(
    resolved = as.numeric(disposition == "Closed by arrest")) %>% 
  select(resolved, victim_age, victim_sex, victim_race)
```

Using the baltimore_data, we fit a logistic regression on resolved. Then obtain the estimate and confidence interval of the adjusted odds ratio for solving homicides comparing male victims to female victims keeping all other variables fixed.

```{r}
# fit a logistic regression model on baltimore data
baltimore_glm <- 
  baltimore_data %>% 
  glm(resolved ~ victim_age + victim_sex + victim_race , data = ., family = binomial())
# obtain the estimate and CI for adjusted OR comparing male victims to female victims
baltimore_glm %>% 
  broom::tidy() %>% 
  mutate(adjusted_OR = exp(estimate),
         CI_OR_Lower = exp(confint(baltimore_glm, level = 0.95))[,1],
         CI_OR_Upper = exp(confint(baltimore_glm, level = 0.95))[,2]) %>%
  select(term, estimate, adjusted_OR, CI_OR_Lower, CI_OR_Upper) %>% 
  filter(term == "victim_sexMale") %>% 
  knitr::kable(digits = 3)

```

